tinymce.PluginManager.add("autolink",function(t){function e(t){o(t,-1,"(",!0)}function n(t){o(t,0,"",!0)}function i(t){o(t,-1,"",!1)}function o(t,e,n){function i(t,e){if(0>e&&(e=0),3==t.nodeType){var n=t.data.length;e>n&&(e=n)}return e}function o(t,e){1!=t.nodeType||t.hasChildNodes()?s.setStart(t,i(t,e)):s.setStartBefore(t)}function r(t,e){1!=t.nodeType||t.hasChildNodes()?s.setEnd(t,i(t,e)):s.setEndAfter(t)}var s,a,f,l,c,g,u,h,C,k;if("A"!=t.selection.getNode().tagName){if(s=t.selection.getRng(!0).cloneRange(),s.startOffset<5){if(h=s.endContainer.previousSibling,!h){if(!s.endContainer.firstChild||!s.endContainer.firstChild.nextSibling)return;h=s.endContainer.firstChild.nextSibling}if(C=h.length,o(h,C),r(h,C),s.endOffset<5)return;a=s.endOffset,l=h}else{if(l=s.endContainer,3!=l.nodeType&&l.firstChild){for(;3!=l.nodeType&&l.firstChild;)l=l.firstChild;3==l.nodeType&&(o(l,0),r(l,l.nodeValue.length))}a=1==s.endOffset?2:s.endOffset-1-e}f=a;do o(l,a>=2?a-2:0),r(l,a>=1?a-1:0),a-=1,k=s.toString();while(" "!=k&&""!==k&&160!=k.charCodeAt(0)&&a-2>=0&&k!=n);s.toString()==n||160==s.toString().charCodeAt(0)?(o(l,a),r(l,f),a+=1):0===s.startOffset?(o(l,0),r(l,f)):(o(l,a),r(l,f)),g=s.toString(),"."==g.charAt(g.length-1)&&r(l,f-1),g=s.toString(),u=g.match(d),u&&("www."==u[1]?u[1]="http://www.":/@$/.test(u[1])&&!/^mailto:/.test(u[1])&&(u[1]="mailto:"+u[1]),c=t.selection.getBookmark(),t.selection.setRng(s),t.execCommand("createlink",!1,u[1]+u[2]),t.settings.default_link_target&&t.dom.setAttrib(t.selection.getNode(),"target",t.settings.default_link_target),t.selection.moveToBookmark(c),t.nodeChanged())}}var r,d=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;return t.settings.autolink_pattern&&(d=t.settings.autolink_pattern),t.on("keydown",function(e){return 13==e.keyCode?i(t):void 0}),tinymce.Env.ie?void t.on("focus",function(){if(!r){r=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(t){}}}):(t.on("keypress",function(n){return 41==n.keyCode?e(t):void 0}),void t.on("keyup",function(e){return 32==e.keyCode?n(t):void 0}))});